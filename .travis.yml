language: python
python: "3.4"
sudo: required
dist: trusty
install:
  - if test -z "$(git diff --name-only $TRAVIS_COMMIT_RANGE -- client/client-multi/client-c)"; then exit 0; fi
  - bash <(curl -sS https://nixos.org/nix/install)
  - source $HOME/.nix-profile/etc/profile.d/nix.sh

  - sudo mkdir /etc/nix
  - sudo sh -c 'echo "build-max-jobs = 4" > /etc/nix/nix.conf'

  - cd client/client-multi/client-c
  - nix-shell -Q --arg cc3200Support false --pure --run true
  - cd ../../..

script:
  - if test -z "$(git diff --name-only $TRAVIS_COMMIT_RANGE -- client/client-multi/client-c)"; then exit 0; fi
  - cd client/client-multi/client-c
  - nix-shell --arg withWerror true --arg cc3200Support false --pure --run "make"
  - nix-shell --arg withWerror true --arg cc3200Support false --pure --run "./build.sh test"
